
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laporan Keuangan</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f4f9; }
        header { background: #4CAF50; color: white; padding: 20px; text-align: center; }
        header h1 { margin: 0; }
        .summary { display: flex; justify-content: center; gap: 20px; margin: 15px 0; }
        .card { background: white; padding: 10px 20px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .container { width: 90%; margin: auto; margin-top: 20px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background: #4CAF50; color: white; }
        tr:nth-child(even) { background: #f9f9f9; }
        .actions button { margin: 2px; padding: 5px 10px; border: none; cursor: pointer; border-radius: 4px; }
        .edit-btn { background: #ff9800; color: white; }
        .delete-btn { background: #f44336; color: white; }
        .add-btn { background: #2196F3; color: white; margin-top: 10px; }
        .export-btn { background: #4CAF50; color: white; margin-top: 10px; }
        input, select { padding: 8px; margin: 5px; border: 1px solid #ccc; border-radius: 4px; }
    </style>
</head>
<body>
    <header>
        <h1>Laporan Keuangan</h1>
        <div class="summary">
            <div class="card">Pemasukan: <span id="totalIncome">0</span></div>
            <div class="card">Pengeluaran: <span id="totalExpense">0</span></div>
            <div class="card">Saldo: <span id="balance">0</span></div>
        </div>
    </header>

    <div class="container">
        <input type="date" id="dateInput">
        <input type="text" id="descInput" placeholder="Deskripsi">
        <input type="number" id="amountInput" placeholder="Jumlah">
        <select id="typeInput">
            <option value="income">Pemasukan</option>
            <option value="expense">Pengeluaran</option>
        </select>
        <button class="add-btn" onclick="addTransaction()">Tambah Transaksi</button>
        <button class="export-btn" onclick="exportExcel()">Export Excel</button>

        <table id="transactionTable">
            <thead>
                <tr>
                    <th>Pilih</th>
                    <th>Tanggal</th>
                    <th>Deskripsi</th>
                    <th>Pemasukan</th>
                    <th>Pengeluaran</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <button class="delete-btn" onclick="deleteSelected()">Hapus Terpilih</button>
    </div>

    <script>
        let transactions = JSON.parse(localStorage.getItem("transactions")) || [];

        function renderTable() {
            const tbody = document.querySelector("#transactionTable tbody");
            tbody.innerHTML = "";
            let totalIncome = 0, totalExpense = 0;
            transactions.forEach((t, index) => {
                let row = `<tr>
                    <td><input type='checkbox' data-index='${index}'></td>
                    <td>${t.date}</td>
                    <td contenteditable="true" onBlur="editTransaction(${index}, 'desc', this.innerText)">${t.desc}</td>
                    <td contenteditable="true" onBlur="editTransaction(${index}, 'income', this.innerText)">${t.type === "income" ? t.amount : ""}</td>
                    <td contenteditable="true" onBlur="editTransaction(${index}, 'expense', this.innerText)">${t.type === "expense" ? t.amount : ""}</td>
                    <td class="actions"><button class="delete-btn" onclick="deleteTransaction(${index})">Hapus</button></td>
                </tr>`;
                tbody.innerHTML += row;
                if (t.type === "income") totalIncome += Number(t.amount);
                else totalExpense += Number(t.amount);
            });
            document.getElementById("totalIncome").innerText = totalIncome;
            document.getElementById("totalExpense").innerText = totalExpense;
            document.getElementById("balance").innerText = totalIncome - totalExpense;
            localStorage.setItem("transactions", JSON.stringify(transactions));
        }

        function addTransaction() {
            const date = document.getElementById("dateInput").value || new Date().toISOString().split("T")[0];
            const desc = document.getElementById("descInput").value;
            const amount = Number(document.getElementById("amountInput").value);
            const type = document.getElementById("typeInput").value;
            if (!desc || !amount) return alert("Lengkapi data!");
            transactions.push({ date, desc, amount, type });
            renderTable();
        }

        function deleteTransaction(index) {
            transactions.splice(index, 1);
            renderTable();
        }

        function deleteSelected() {
            const checkboxes = document.querySelectorAll("tbody input[type='checkbox']:checked");
            let indexes = Array.from(checkboxes).map(cb => Number(cb.getAttribute("data-index")));
            transactions = transactions.filter((_, i) => !indexes.includes(i));
            renderTable();
        }

        function editTransaction(index, field, value) {
            if (field === "desc") transactions[index].desc = value;
            if (field === "income") { transactions[index].type = "income"; transactions[index].amount = Number(value); }
            if (field === "expense") { transactions[index].type = "expense"; transactions[index].amount = Number(value); }
            renderTable();
        }

        function exportExcel() {
            let csv = "Tanggal,Deskripsi,Pemasukan,Pengeluaran\n";
            transactions.forEach(t => {
                csv += `${t.date},${t.desc},${t.type === "income" ? t.amount : ""},${t.type === "expense" ? t.amount : ""}\n`;
            });
            let blob = new Blob([csv], { type: "text/csv" });
            let link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "laporan_keuangan.csv";
            link.click();
        }

        renderTable();
    </script>
</body>
</html>
